<%
  next_rerun = @workshop.ongoing_or_next_rerun
  content_for(:title, seod_title(@workshop))
%>
<div class="row">
  <div class="span3">
    <%= iconic_link_to 'back', root_path, :icon => 'chevron-left' %>
  </div>
</div>
<div class="row">
  <div class="span2">
    <p class="hidden-phone">
      <%= image_tag(@workshop.img_src(:large), :class => "img-rounded large_page_thumb") %>
      <%= render 'events/smart_attend_btn', :event => next_rerun, :no_check => true, :cta => 'Sign up', :btn_classes => 'btn-block' %>
      <%= render 'reviews/add_review', :workshop => @workshop, :unreviewed_events => @unreviewed_events %>
    </p>
  </div>
  <div class="span7">
    <h1 class="margin_top0"><%= @workshop.title %></h1>
    <div class="row">
      <div class="span2">
        <% if next_rerun %>
          <div class="blocky_spns">
            <%= meeting_time(next_rerun.first_meeting, :short_date => true, :no_tz => true, :show_livestamp => true, :show_end_time => false) %>
          </div>
          <p><%= render :partial => 'events/inline_attend_state', :locals => {:event => next_rerun} %></p>
        <% else %>
          <span class="muted">no upcoming dates</span>
        <% end %>
      </div>
      <div class="span3">
        <p>
          <%= render('reruns/location', :rerun => next_rerun) if next_rerun %>
        </p>
      </div>

      <div class="span2">
        <%= render 'reruns/price_full_or_spots_left', :rerun => next_rerun %>
      </div>

      <div class="hidden-tablet hidden-desktop">
        <%= render 'events/smart_attend_btn', :event => next_rerun, :no_check => true, :cta => 'Sign up', :btn_classes => 'btn-block' %>
      </div>
    
    </div>
    
    <p class="event_description clearfix">
      <%= BlueCloth.new(@workshop.description, :filter_html).to_html.html_safe %>
    </p>
    
    <ul class="nav nav-tabs margin0">
      <li class="active"><a href="#future" data-toggle="tab">Coming Up (<%= @future_reruns.count %>)</a></li>
      <li><a href="#past" data-toggle="tab">Past (<%= @past_reruns.count %>)</a></li>
      <li><a href="#reviews" data-toggle="tab">Reviews (<%= @reviews.count %>)</a></li>
    </ul>

    <div id="myTabContent" class="tab-content">
      <div class="tab-pane active" id="future">
        <% if @future_reruns.count == 0 %>
          No future workshops.
        <% else %>
          <%= render 'reruns/index', :reruns => @future_reruns, :click_to_show => false, :hide_flags => true %>
        <% end %>
      </div>
      <div class="tab-pane fade" id="past">
        <% if @past_reruns.count == 0 %>
          No past workshops.
        <% else %>
          <%= render 'reruns/index', :reruns => @past_reruns, :click_to_show => false, :hide_flags => true %>
        <% end %>
      </div>
      <div class="tab-pane fade" id="reviews">
        <% if @reviews.count == 0 %>
            No reviews.
        <% else %>
            <%= render 'reviews/index', :reviews => @reviews %>
        <% end %>
      </div>
    </div>
    
  </div>
  <div class="span3 side_content">
    <%= render 'events/smart_attend_btn', :event => next_rerun, :no_check => true, :cta => 'Sign up', :btn_classes => 'btn-block' %>
    
    <h4 class="muted">Host</h4>
    <%= render 'users/mini_profile', :user => @workshop.host %>
    <h4 class="muted">People</h4>
    <div class="row">
      <div class="span3">
        <%= render 'reruns/attendees_pseudo_feed', :rerun => next_rerun, :sign_up_msg => 'signed up' %>
      </div>
    </div>
  </div>
</div>

<!-- Add Review Modal -->
<div class="modal fade" id="modal-add-review" tabindex="-1" role="dialog" aria-labelledby="modalAddReview" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="modalAddReview">Add Review</h4>
      </div>
      <%= simple_form_for(@review, :remote => true, html: {id: 'review-form'} ) do |f| %>
        <div class="modal-body">
          <div class="review-elements">
            <%= f.select 'event_id', @unreviewed_events.collect{ |event| [meeting_time(event.first_meeting, :short_date => true, :no_tz => true, :show_livestamp => false), event.id]}, { :include_blank => true } %>
            <%= f.input :title %>
            <%= f.input :body %>
          </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <%= f.button :submit, 'Add it!'%>
        </div>
      <% end %>
    </div>
  </div>
</div>

<div class="hidden">
    <%= link_to '#', add_review_path, id: 'add_review' %>
</div>
