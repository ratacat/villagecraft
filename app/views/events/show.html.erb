<% use_embedded_map = (blur_event_location?(@event) and @event.venue.location.neighborhood.nil?) %>
<h1><%= @event.title %>
  <% if @event.host === current_user %>
    <%= link_to 'Edit', edit_event_path(@event), :class => 'btn btn-small' %>        
  <% end %>
</h1>
<h4 class="event_time">
  <%= render :partial => 'times' %>
</h4>
<div class="row">
  <div class="span8">
    <p>
      <%= render :partial => 'events/attends_meter', :locals => { :event => @event } %> <%= link_to pluralize(@event.attendees.count, 'attendee'), attendees_path(@event), 'data-toggle' => 'modal', 'data-target' => '#attendees_modal' %>
    </p>

    <% if @event.venue.blank? %>
      location: TBD
    <% else %>
      <address>
        <strong><%= link_to @event.venue.name, @event.venue %></strong><br/>
        <%= render :partial => 'locations/inline', :locals => {:location => @event.venue.location, :blur => blur_event_location?(@event)} %>
        <p>
          <div id="map-canvas" class="img-polaroid"><%= render(:partial => 'locations/embedded_gmap', :locals => {:q => city_n_state(@event.venue.location)}) if use_embedded_map %></div>
        </p>
      </address>
    <% end %>

    <p>
      <%= @event.description %>
    </p>

    <p>
      hosted by: <%= contextualized_user_link @event.host %>
    </p>    
    <% unless @event.host === current_user %>
      <%= render :partial => 'events/attend_status_and_call_to_action' %>  
    <% end %>
  </div>
</div>

<div class="row">
  <%= render :partial => 'activities/index', :locals => {:activities => @event.activities} %>
</div>
<%= render :partial => 'attendees_modal' %>

<% ready_script do -%>
  $("#secret").popover();
  <%= render(:partial => 'venues/load_gmap.js', :locals => {:venue => @event.venue, :blur => blur_event_location?(@event)}) unless (use_embedded_map or @event.venue.blank?) %>
<% end -%>