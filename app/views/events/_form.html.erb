<%
   show_submit_button ||= false
%>
<%= simple_form_for(@event) do |f| %>
  <%= f.error_notification %>

  <div class="form-inputs row">
    <div class="col-md-9">
      <%= f.input :title, label: 'Title', input_html: {class: 'col-md-8'} %>
      <%= f.input :description, as: :text, input_html: {:rows => "6", :'data-provide' => "markdown"} %>
      <% if admin_session? and @event.external%>
        <div class="well admin-only">
          <%= f.input :external %>

          <%= f.label "External URL" %>
          <%= f.input :external_url, :wrapper => :append, label: false do %>
            <%= f.input_field :external_url %><span class="input-group-addon"><i class="fa fa-external-link"></i></span>
          <% end %>

          <%= f.input :host_id, label: 'External Host', collection: User.where(:external => true), hint: %Q(Select an external host or #{link_to('create a new one', new_admin_user_path)}.).html_safe %>
        </div>
      <% end %>
      <div class="row">
        <div class="col-sm-4">
          <%= f.input :location_id, collection: @venues.collect { |p| [ p.name, p.id, {'data-address' => p.location.address} ] }, label: 'Location', input_html: {class: 'col-sm-4'}  %>
        </div>
        <div class="col-sm-8 col-xs-nolabel">
          <%= f.input :address, label: '&nbsp;'.html_safe %>
        </div>
      </div>
      <div class="row">
      <%= f.input :when, label: 'When', required: true, wrapper_html: {class: 'datepair col-xs-12 col-sm-3'} do %>
        <%= f.input_field :start_time_date, :as => :date_select, :class => "start date form-control  col-xs-12 col-sm-3",
                          :value => l(@event.localized_start_time, format: :date_picker_date_format).strip %>
        <%= f.input_field :start_time_time, :as => :time_select, :class => "start time form-control  col-xs-12 col-sm-3",
                          :value => l(@event.localized_start_time, format: :time_picker_time_format).strip %>
        <% end %>

      <div class="col-sm-1 datepair-to">
        to
      </div>
      <%= f.input :when, label: '&nbsp;'.html_safe, required: false, wrapper_html: {class: 'datepair col-sm-3 col-xs-12'} do %>
        <%= f.input_field :end_time_time, :as => :time_select, :class => "end time form-control col-sm-3  col-xs-12",
                          :value => l(@event.localized_end_time, format: :time_picker_time_format).strip %>
        <%= f.input_field :end_time_date, :as => :date_select, :class => "end date form-control col-sm-3  col-xs-12",
                          :value => l(@event.localized_end_time, format: :date_picker_date_format).strip %>
      <% end %>
      </div>

      <div class="row">
        <div class="col-sm-4">
          <%= f.input :cost_type, collection: Event::COST_TYPE_LABEL.collect{ |k,v| [ v, k ] }, label: 'Cost', input_html: {class: 'col-sm-4'}  %>
        </div>
        <div class="col-sm-2  col-xs-nolabel">
          <%= f.input :price, label: '&nbsp;'.html_safe, input_html: {style: 'display: none'} %>
        </div>
        <div class="col-sm-2  col-xs-nolabel">
          <%= f.input :end_price, label: '&nbsp;'.html_safe, input_html: {style: 'display: none'} %>
        </div>
      </div>

      <%= f.input :rsvp, label: false  %>


      <% if show_submit_button %>
        <div class="form-actions">
          <%= f.button :submit, :class => "btn btn-primary" %>
        </div>
      <% end %>
    </div>
    <div class="col-md-3">
      <%= render :partial => 'images/fancy_jansy_upload', :locals => {:f => f, :size => :large_orig, :img_url => @event.img_src(:large_orig)} %>
    </div>
  </div>
<% end %>

<% body_script do -%>
  <%= render :partial => 'meetings/init_datepair_picker', :formats => [:js] %>
  $(function(){
    init_datetime_picker();
    $('#event_location_id').change(function(){
      $('#event_address').val($('option:selected',$(this)).data('address'));
    })

    $('#event_cost_type').change(function(){
      val = $('option:selected',$(this)).attr('value');
      if( val == 'free' || val == 'donation' || val == '' ){
        $('#event_price').hide();
        $('#event_price').val('');
        $('#event_end_price').hide();
        $('#event_end_price').val('');
      }else if( val == 'set_price'){
        $('#event_price').show();
        $('#event_end_price').hide();
        $('#event_end_price').val('');
      }else if( val == 'sliding_scale'){
        $('#event_price').show();
        $('#event_end_price').show();
      }
    })
  $("#event_rsvp").bootstrapSwitch();
  })


<% end %>