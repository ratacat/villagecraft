<%= simple_form_for(@event, html: {class: "form-horizontal"}) do |f| %>
  <%= f.error_notification %>

  	<%= f.input :title %>
  	<%= f.input :short_title, label: 'Short Title' %>

    <%= f.input :when, label: 'When', required: true, wrapper_html: {class: 'controls-row datepair'} do %>
      <%= f.input_field :start_time_date, :as => :date_select, :class => "start date", 
          :value => l(@event.localized_start_time, format: :date_picker_date_format).strip %>
      <%= f.input_field :start_time_time, :as => :time_select, :class => "start time",
          :value => l(@event.localized_start_time, format: :time_picker_time_format).strip %> to 
      <%= f.input_field :end_time_time, :as => :time_select, :class => "end time",
          :value => l(@event.localized_end_time, format: :time_picker_time_format).strip %>
      <%= f.input_field :end_time_date, :as => :date_select, :class => "end date",
          :value => l(@event.localized_end_time, format: :date_picker_date_format).strip %>
    <% end %>
    
  	<%= f.association :venue, label: 'Where', collection: users_venue_options(current_user), label_method: :name, value_method: :uuid, selected: @event.venue.try(:uuid), input_html: {:class => "venues_select"} %>
  	<div class="control-group">
      <%= f.label "Profile Image" %>
      <div class="controls">
        <%= image_tag @event.img_src(:large), :class => "img-rounded" %>
        <%= f.file_field :image %><br/>
      </div>
    </div>
    
  	<%= f.input :min_attendees, input_html: {:min => 0} %>
  	<%= f.input :max_attendees, input_html: {:min => 0} %>
  	
  	<%= f.input :secret, hint: "At the event, tell attendees this secret so they can confirm their attendance.", disabled: true %>
  	
    <%= f.input :description, as: :text, input_html: {:rows => "6", :class => 'span5'} %>

  <div class="form-actions">
    <%= f.button :submit, class: "btn btn-primary" %>
  </div>
<% end %>

<div id="add_venue_dialog" class="modal hide fade" tabindex="-1" data-backdrop="static" data-keyboard="true" role="dialog" aria-hidden="true" >
  <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h3>Add Venue</h3>
    </div>
  <div class="modal-body">
    <%= render :partial => 'venues/form', :locals => { :remote => true, :venue => (@event.venue || Venue.new) } %>
  </div>
</div>

<% ready_script do -%>
  var DATEPICKER_FORMAT = "<%= t 'time.formats.php_style_time_picker_time_format' %>";
  var TIMEPICKER_FORMAT = "<%= t 'time.formats.php_style_date_picker_date_format' %>";
  var DATE_FORMAT = "<%= t 'time.formats.php_style_date_format' %>"; // for this format see http://php.net/manual/function.date.php

  <%= render :partial => 'events/init_datetime_pickers.js' %>
  
  $("#event_venue_id").change(function(e) {
    if ($("#event_venue_id option:selected")[0] === $("#event_venue_id option:last")[0]) {
      $('select.venues_select').val(null);
      $('#add_venue_dialog').modal('show');
    };
  });
  $('#new_venue').on('ajax:success', function(event, data, status, xhr) {
    $('#add_venue_dialog').modal('hide');
  });
  $(":file").filestyle({ 
    textField: false,
    buttonText: "Choose photo",
    icon: true 
  });
  $("#event_image").change(function() {
      $(this).closest("form").submit();
    }
  );
  
<% end -%>
